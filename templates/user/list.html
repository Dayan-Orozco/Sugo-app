{% extends 'base.html' %}

{% block title %}Listado Usuarias{% endblock %}

{% block content %}
<div class="card shadow p-3">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">Listado de Usuarias</h1>
        <a  href="{% url 'register'%}" class="btn btn-primary btn-sm"><i class="fa-solid fa-user-plus"></i> Registrar Nueva Streamer</a>
    </div>
    <div class="row justify-content-between my-3">
        <div class="col-md-7 mb-1">
            <form method="get" class="align-content-center row p-0">
                <div class="col-md-6 pb-1">
                    <form method="get" class="align-content-center">
                        <div class="input-group">
                            <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Buscar por Documento, Nombre o N° Telegram">
                            <button type="submit" class="btn btn-primary btn-sm">Buscar</button>
                        </div>
                    {% if query %}
                    <a href="{% url 'user_list' %}" class="btn btn-outline-secondary btn-sm">X</a>
                    {% endif %}
                </div>            
                <div class="col-md-6 pb-1">
                    <div class="align-content-center d-flex">                  
                        <input type="date" name="start_date" value="{{ start_date }}" class="form-control">
                        <input type="date" name="end_date" value="{{ end_date }}" class="form-control">
                    </div>
                </div>
            </form>            
        </div>
        <div class="col-md-5 mb-1 align-content-center">
            <div class="d-flex justify-content-between">
                <div class="align-content-center">Pendientes: <strong>{{pending}}</strong></div>
                <div class="align-content-center">Total: <strong>{{ total }}</strong></div>
                <div class="align-content-center">
                    <ul class="pagination m-0">
                    {% if page_obj.has_previous %}
                        <li class="page-item"><a class="page-link" href="?q={{ query }}&page=1">&laquo;</a></li>
                        <li class="page-item"><a class="page-link" href="?q={{ query }}&page={{ page_obj.previous_page_number }}">Anterior</a></li>
                    {% endif %}
                    <li class="page-item active">
                        <span class="page-link">
                        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                        </span>
                    </li>
                    {% if page_obj.has_next %}
                        <li class="page-item"><a class="page-link" href="?q={{ query }}&page={{ page_obj.next_page_number }}">Siguiente</a></li>
                        <li class="page-item"><a class="page-link" href="?q={{ query }}&page={{ page_obj.paginator.num_pages }}">&raquo;</a></li>
                    {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="my-3">        
        {% if messages %}
        {% for message in messages %}
            {% if message.tags == "success" %}
            <div class="alert alert-success text-normal">{{ message }}</div>
            {% elif message.tags == "warning" %}
            <div class="alert alert-warning text-normal">{{ message }}</div>
            {% elif message.tags == "error" %}
            <div class="alert alert-danger text-normal">{{ message }}</div>
            {% endif %}
        {% endfor %}
        <br>
        {% endif %}
        <table class="table table-bordered table-hover table-striped">
            <thead class="table-dark">
                <tr>
                    {% for col, label in columns %}
                    <th class="text-nowrap">
                        <a class="text-decoration-none text-light" href="?q={{ query }}&order_by={{ col }}&direction={% if order_by == col and direction == 'asc' %}desc{% else %}asc{% endif %}">
                            {{ label }}
                        </a>
                        {% if order_by == col %}
                            <span class="ms-1">
                                {% if direction == 'asc' %}
                                    ▲
                                {% else %}
                                    ▼
                                {% endif %}
                            </span>
                        {% endif %}
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for user in page_obj %}
                <tr>                    
                    <td>{{ user.id }}</td>
                    <td><a href="{% url 'user_edit' user.username %}" class="text-a-index">{{ user.username }}</a></td>
                    <td>{{ user.document }}</td>
                    <td>{{ user.first_name }} {{ user.last_name }}</td>
                    <td>
                        {% if user.telegram_number %}
                            <a href="https://t.me/+{{user.telegram_number}}" target="_blank"><i class="fa-brands fa-telegram"></i></a>
                        {% else %}
                            No Tiene
                        {% endif %}
                    </td>
                    <td>{{ user.email }}</td>                    
                    <td>
                        {% if user.is_active %}
                            Activa/o
                        {% else %}
                            <button type="button" onclick="ActivateUser({{ user.id }})" class="btn btn-danger btn-sm btn-sm-sm">Activar</button>
                        {% endif %}
                    </td>
                    <td>{{ user.get_country_display }}</td>
                    <td>
                        {% if user.date_joined %}
                            {{ user.date_joined|timesince}}  
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">No hay users registrados.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    
    </div>
</div>

{% endblock %}
